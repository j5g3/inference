!function(a){"use strict";function b(a){this.handler=a||c,this.current={tag:null,type:null,ident:null,text:null,start:0,end:0},this.map=this._buildMap()}var c={handle:function(a){a.meta=a.meta||{},a.meta[a.tag]={type:a.type,ident:a.ident,text:a.text}}};b.prototype={REGEX:/@(\w+)([ \t]*)(.*)$/gm,CLEAN:/^\s*[\/\*]+\s?|[ \t]+$/gm,TYPE:/^\{\(?([\w\d_ <>\|\.\#]+)\)?\}\s*|([\w\d_\.#]+)\s*/,TYPENAMETEXT:/^\{\(?([ <>\w\d_\|\.\#]+)\)?\}\s*([\.\w\d_]*)\s*(.*)/,TYPETEXT:/^(\{\(?([ <>\w\d_\|\.\#]+)\)?\})?\s*(.*)/,NAMETEXT:/([\.\w\d_]+)\s*(.*)/,alias:{virtual:"abstract",augments:"extends",extend:"extends","const":"constant",constructor:"constructor",emits:"fires","return":"returns"},parsers:{parseType:"alias|borrows|callback|constant|constructs|const|enum|emits|event|type|exports|extends|external|fires|lends|memberof|method|mixes|mixin|name",parseTypeNameText:"param|property|typedef",parseTypeText:"returns|this",parseText:"author|deprecated|copyright|classdesc|desc|license|requires|since|summary|throws|todo|variation|version|see"},_buildMap:function(){var a,b,c,d={};for(a in this.parsers)for(b=this.parsers[a].split("|");c=b.pop();)d[c]=this[a];return d.constructor=!1,d},parseNameText:function(a,b){var c=this.NAMETEXT.exec(b);return c&&(a.ident=c[1],a.text=c[2]),b.length},parseTypeNameText:function(a,b){var c=this.TYPENAMETEXT.exec(b);return c?(a.type=c[1],a.ident=c[2],a.text=c[3],b.length):this.parseNameText(a,b)},parseTypeText:function(a,b){var c=this.TYPETEXT.exec(b);return a.type=c[2],a.text=c[3],b.length},parseType:function(a,b){var c=this.TYPE.exec(b);return(a.text=c&&(c[1]||c[2]))&&(a.type=a.text),c&&c[0].length},parseText:function(a,b){return a.text=b,b.length},parseMatch:function(a){var b=this.current,c=b.tag=this.alias[a[1]]||a[1],d=0,e=this.map[c];return b.start=a.index,b.type=b.ident=b.text=null,d=e&&e.call(this,b,a[3])||d,b.end=b.start+a[1].length+1+a[2].length+d,b},parseRegex:function(a,b){for(var c,d,e;c=b.exec(a);)d=this.parseMatch(c),e=d.tag,(this.handler[e]||this.handler.handle).call(this.handler,d),a=a.slice(0,d.start)+a.slice(d.end),b.lastIndex=d.start;return a},parse:function(a,b){return"*"!==a[0]&&"/"!==a[0]||/@ignore(?=\s|$)/.test(a)?void 0:(this.current.meta=b,a=this.parseRegex(a.replace(this.CLEAN,""),this.REGEX).trim(),a&&(this.current.tag="desc",this.current.text=a,(this.handler.desc||this.handler.handle)(this.current)),this.current.meta)}},a.JSDocParser=b}("undefined"==typeof exports?this.j5g3||(this.j5g3={}):exports),function(a,b){"use strict";var c,d,e;"undefined"!=typeof exports?(c=exports,d=require("esprima"),e=require("j5g3.jsdoc-parser").JSDocParser):(c=a.j5g3,d=a.esprima,e=c.JSDocParser),b(c,d,e)}(this,function(a,b,c){"use strict";function d(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function e(){}function f(a,b){var c=this;c.name=a,c.tags=new e,c.type=new k,c.tags.public=!0,void 0!==b&&c.set(b)}function g(){}function h(a){this.scope=a,this.symbols={},this.build(this.scope.root,this.scope.module)}function i(){this.properties={},this.add("hasOwnProperty",new f("hasOwnProperty",q)),this.properties.hasOwnProperty.tags.system=!0,this.modified=!1}function j(a){i.call(this),this.name=a,this.index=0,this.scope=new l,this.scope.this=new f("this"),this.initPrototype()}function k(){}function l(){}function m(){var a=this.root=new i;this.root.scope=this.root.properties,this.module=new f,this.module.value=a,this.module.tags.root=!0,this.module.id=a.parent="<root>",this.stack=[this.current=this.root.properties]}function n(a){this.compiler=a}function o(a){this.scope=a.scope,this.jsdoc=new c(new n(a))}function p(a){d(this,a),this.scope=new m,this.walker=this.walker||new o(this),this.files={},this.initSymbols()}var q=Object.prototype.hasOwnProperty;e.prototype={constructor:!1,toArray:function(){return Object.keys(this)},set:function(a,b){var c=this[a];c instanceof Array?c.push(b):this[a]=c&&c!==!0?[c,b]:b,(this.private||this.protected)&&delete this.public}},f.prototype={set:function(a){return a!==g&&(a instanceof f?this.copy(a):(this.type.set(a),this.value=a)),a},copy:function(a){this.set(a.value),d(this.tags,a.tags),(this.tags.private||this.tags.protected)&&delete this.tags.public},toString:function(){return this.value&&this.value.toString()},toJSON:function(){var a=d({},this);return a.value=a.value&&a.value.toString(),a.type=a.type&&a.type.toString(),a}},h.prototype={build:function(a,b){var c,d,e;a.parent=b.id;for(c in a.properties)d=a.properties[c],e=d.value,this.process(d,b),e&&e.properties&&!e.parent&&this.build(e,d)},process:function(a,b){this.processTags(a,b),this.processId(a,b),this.symbols[a.id]=a},tagAlias:function(a){a.value&&a.value.parent&&(a.tags.alias=a.value.parent)},tagExtends:function(a){var b,c=a.value;c instanceof j&&(b=c.properties.prototype.value.properties.constructor,b instanceof f&&(a.tags.extends=b.value.parent))},tagMethod:function(a,b){var c=a.value instanceof j;b.tags.proto&&(a.tags[c?"method":"property"]=!0)},tagStatic:function(a,b){b.tags.proto||!(b.value instanceof i)||a.tags.namespace||a.tags.class||a.tags.mixin||a.tags.method||(a.tags.static=!0)},tagClass:function(a){if(!a.tags.method&&a.type.function){var b=a.value.properties.prototype.value;b&&b.modified&&(a.tags.class=!0)}},processTags:function(a,b){this.tagAlias(a),this.tagExtends(a),this.tagMethod(a,b),this.tagClass(a),this.tagStatic(a,b)},processId:function(a,b){a.id=b&&b.id&&!b.tags.root?b.id+(a.tags.proto?"#":b.tags.proto?a.name:"."+a.name):a.name}},i.prototype={add:function(a,b){return this.modified=!0,this.properties[a]=b,b},"delete":function(a){delete this.properties[a]},get:function(a){var b=q.call(this.properties,a)&&this.properties[a];return void 0===b&&this.properties.constructor instanceof i&&(b=this.properties.constructor.get(a)),b},each:function(a,b){b=b||this;for(var c in this.properties)a.call(b,c,this.properties[c])},toString:function(){return"object"}},j.prototype=Object.create(i.prototype),d(j.prototype,{initPrototype:function(){var a=new f("prototype");a.set(new i),a.tags.missing=!0,a.tags.proto=!0,this.add("prototype",a)},toJSON:function(){var a=d({},this);return delete a.body,a},toStringParam:function(a){var b=a.name+":"+a.type;return"undefined"in a.type&&(b="["+b+"]"),b},toString:function(){var a="function "+(this.name||"")+"(";return this.parameters&&(a+=this.parameters.map(this.toStringParam).join(", ")),a+")"+(this.returns?":"+this.returns:"")},findParameter:function(a){var b,c=0;if(this.parameters||(this.parameters=[]),a){for(;c<this.parameters.length;c++)if(b=this.parameters[c],b.name===a)return b}else if(b=this.parameters[this.index++])return b;return this.parameters.push(b=new f(a)),b}}),k.prototype={types:["null","object","boolean","number","string","array","function"],alias:{Array:"array",String:"string",Number:"number",Object:"object"},set:function(a){var b;b=a instanceof j?"function":a instanceof Array?"array":null===a?"null":a instanceof Function?"native":typeof a,delete this.undefined,this[b]=a},parseType:function(a){var b=a.trim();if(-1===this.types.indexOf(b)){if(!this.alias[b])return void(this.other||(this.other=[])).push(b);b=this.alias[b]}this[b]=b},parse:function(a){a&&a.split("|").forEach(this.parseType,this)},toString:function(){var a=this.other?this.other.join("|"):"";return this.types.filter(function(a){return a in this},this).join("|")+a||"?"}},d(m.prototype,{addGlobal:function(a){this.root.add(a.name,a),a.tags.global=!0},setCurrent:function(a){return this.current=a,this},push:function(a){return this.stack.push(this.current),this.setCurrent(a)},pop:function(){return this.setCurrent(this.stack.pop())},add:function(a){return this.current===this.root.scope?this.addGlobal(a):this.current[a.name]=a,this},get:function(a){var b,c=this.stack.length-1,d=this.current;do if(b=d[a])return b;while(d=this.stack[c--]);return this.root.get(a)},getThis:function(){return this.current===this.root.scope?this.root:this.get("this")}});var r={Program:function(a){a.comments&&a.comments[0]&&0===a.comments[0].range[0]&&(this.jsdoc.parse(a.comments[0].value,this.scope.file),a.comments[0].value="");var b,c=this.walkProperty(a.body);return a.comments&&(b=new f("dummy"),a.comments.forEach(function(a){a.value&&this.jsdoc.parse(a.value,b)},this)),c},Parameter:function(a){return new f(a.name)},ThisExpression:function(){return this.scope.getThis()},BlockStatement:function(a){return this.walkProperty(a.body)},IfStatement:function(a){var b=this.walk(a.test);return this.walk(b?a.consequent:a.alternate)},ConditionalExpression:function(a){return this.IfStatement(a)},Value:function(a){var b=this.walk(a);return b instanceof f?b.value:b},CallExpression:function(a){var b=this.Function(a);return b?this.doCall(b,a.arguments):(this.walkProperty(a.arguments),g)},UnaryExpression:function(a){var b=this.Value(a.argument);switch(a.operator){case"typeof":return b instanceof j?"function":typeof b;case"-":return-b;case"+":return+b;case"!":return!b;case"~":return~b;case"void":return void b;case"delete":return!0}},BinaryExpression:function(a){var b=this.Value(a.left),c=this.Value(a.right);switch(a.operator){case"===":return b===c;case"==":return b==c;case"!==":return b!==c;case"!=":return b!=c;case"-":return b-c;case"+":return b+c;case"/":return b/c;case"*":return b*c;case"in":return b in c;default:this.unsupported(a)}},String:function(a){var b=this.walk(a);return b&&b.toString()},Object:function(a){var b=this.walk(a),c=b;return b instanceof f&&(c=b.value),c||this.missingObject(b)},MemberExpression:function(a){var b,c,d=a.property;return this.transferComments(a,d),c=this.Object(a.object),c instanceof i?(a.computed&&(d={type:"Identifier",loc:d.loc,name:this.String(d)}),b=c.get(d.name)||this.missingProperty(c,d),b.value instanceof j?b.value.obj=c:b.type.native&&(b.value.obj=c.properties),b):void 0},AssignmentExpression:function(a){if("="===a.operator){this.transferComments(a,a.left);var b=this.walk(a.left),c=this.walk(a.right);if(b instanceof f)return delete b.tags.missing,b.set(c),b.value}},ForInStatement:function(a){var b,c,d,e=this.Value(a.right);if(b=this.walk(a.left.declarations?a.left.declarations[0]:a.left),b instanceof f){e&&e.properties&&(e=e.properties);for(c in e)b.set(c),d=this.walk(a.body)}return d},LogicalExpression:function(a){var b=this.Value(a.left),c=this.Value(a.right);switch(a.operator){case"&&":return b&&c;case"||":return b||c;default:return this.default(a)}},ExpressionStatement:function(a){return this.transferComments(a,a.expression),this.walk(a.expression)},Literal:function(a){return a.value},ArrayExpression:function(a){var b=a.elements.map(function(a){return this.walk(a)},this);return b},Identifier:function(a){return this.scope.get(a.name)||this.missingSymbol(a)},Property:function(a){this.transferComments(a,a.key);var b=this.createSymbol(a.key,this.walk(a.value));return"get"===a.kind?b.tags.getter=!0:"set"===a.kind&&(b.tags.setter=!0),b},ObjectExpression:function(a){var b,c,d=new i;return a.properties.length&&(this.transferComments(a,a.properties[0].key),a.properties.forEach(function(a){b=this.Property(a),d.add(b.name,b),b.lends&&(c=b.lends),c&&c.add(b.name,b)},this)),d},VariableDeclarator:function(a){var b=this.declareSymbol(this.transferComments(a,a.id));return this.scope.add(b),this.defineSymbol(b,a.init?this.walk(a.init):void 0)},VariableDeclaration:function(a){a.declarations&&a.declarations[0]&&this.transferComments(a,a.declarations[0]),a.declarations.forEach(this.VariableDeclarator.bind(this))},FunctionDeclaration:function(a){var b=this.FunctionExpression(a),c=this.createSymbol(a.id,b);return this.scope.add(c),c},FunctionExpression:function(a){var b=a.id&&a.id.name,c=new j(b);return c.parameters=a.params.map(function(a){return c.scope[a.name]=this.Parameter(a),c.scope[a.name]},this),a.id&&this.transferComments(a,a.id),c.body=a.body,c},NewExpression:function(a){var b,c=this.walk(a.callee),d=c instanceof f?c.value:c,e=new i;return d&&(this.doCall(d,a.arguments,e),b=new f("constructor",c),b.tags.system=!0,e.add("constructor",b)),e},ReturnStatement:function(a){return this.walk(a.argument)},Function:function(a){var b=this.walk(a.callee),c=b instanceof f?b.value:b;return c&&(c instanceof j||c.constructor===Function)?c:void 0},"default":function(a){this.unsupported(a)}},s={error:function(){a.docs.debug&&void 0!==typeof console&&console.log.apply(console,arguments)},unsupported:function(a){this.error("Unsupported node:",a)},warning:function(){a.docs.debug&&void 0!==typeof console&&console.warn.apply(console,arguments)},missingSymbol:function(a){var b=this.createSymbol(a);return b.tags.missing=!0,this.scope.addGlobal(b),b},missingObject:function(a){return a.value=new i,a.value},missingProperty:function(a,b){var c=this.declareSymbol(b);return c.tags.missing=!0,a.add(c.name,c),this.defineSymbol(c)}};n.prototype={_makeFunction:function(a){var b,c=a.meta.value;c instanceof j||(b=new j,c&&c.properties&&(b.properties=c.properties),b.properties.prototype&&(b.properties.prototype.tags.proto=!0),a.meta.set(b))},constructor:function(a){this._makeFunction(a),a.meta.tags.constructor=!0},"class":function(a){this._makeFunction(a),a.meta.tags.class=!0},fires:function(a){this.applySymbol("event",a.type),a.meta.tags.set("fires",a.type)},param:function(a){if(a.meta.value instanceof j){var b=a.meta.value.findParameter(a.ident);b.type.parse(a.type),b.tags.desc=a.text}},lends:function(a){var b=this.compiler.findSymbol(a.type)||this.compiler.scope.module,c=b.value||b.set(new i);a.meta.lends=c},applySymbol:function(a,b,c){var d=this.compiler.findSymbol(b);return a&&d&&d.tags.set(a,c||!0),d},"this":function(a){if(a.meta.value instanceof j){var b=a.meta.value.scope.this;b.type.parse(a.type),b.tags.desc=a.text}},type:function(a){var b=a.meta;b.type.parse(a.type),b.value||(b.type.object?b.value=new i:b.type.function&&(b.value=new j))},returns:function(a){var b=a.meta.tags.returns=new k;b.parse(a.type),b.desc=a.text,a.meta.value instanceof j&&(a.meta.value.returns=b)},handle:function(a){switch(a.tag){case"external":case"callback":case"event":a.meta=this.applySymbol(a.tag,a.type);break;case"name":a.meta=this.applySymbol(!1,a.type);break;default:a.meta.tags.set(a.tag,a.text||!0)}}},d(o.prototype,s),d(o.prototype,r),d(o.prototype,{system:!1,isUnknown:function(a){return a===g},transferComments:function(a,b){var c=a.leadingComments,d=b.leadingComments;return c&&(d?d.push.apply(d,c.leadingComments):b.leadingComments=c,delete a.leadingComments),b},declareSymbol:function(a){var b="Identifier"===a.type?a.name:this.walk(a),c=new f(b);return a.loc&&(c.source=this.scope.file.name+"#"+a.loc.start.line),this.system&&(c.tags.system=!0),c.comments=a.leadingComments,c},parseComments:function(a){return a.comments&&(a.comments.forEach(function(b){this.jsdoc.parse(b.value,a),b.value=!1},this),delete a.comments),a},defineSymbol:function(a,b){return a.set(b),this.parseComments(a),a},createSymbol:function(a,b){return this.defineSymbol(this.declareSymbol(a),b)},doCallFunctionType:function(a,b,c){var d;return a.parameters&&a.parameters.forEach(function(a,c){a.set(this.Value(b[c]))},this),a.body&&(a.scope.this.value=c||a.obj,this.scope.push(a.scope),d=this.walk(a.body),this.scope.pop()),d},doCallNative:function(a,b,c){var d=[];return b&&b.forEach(function(a){d.push(this.Value(a))},this),a.apply(c||a.obj,d)},doCall:function(a,b,c){return a instanceof j?this.doCallFunctionType(a,b,c):this.doCallNative(a,b,c)},walkProperty:function(a,b){var c,d,e;for(c=0;c<a.length&&(d=this.walk(a[c]),d===g&&(e=d),!("ReturnStatement"===a[c].type||b&&b(d)));c++);return e||d},walk:function(a){var b;return a&&a.type&&(b=this[a.type]||this.default)?b.call(this,a):void 0}}),p.prototype={node:!1,initSymbols:function(){var a="Object.create = function(proto) { var F = function() {}; F.prototype = proto; return new F(); };";this.node&&(a+="this.exports = this;");var c=b.parse(a);this.walker.system=!0,this.walker.walk(c),delete this.walker.system},compile:function(a,b){var c=new f(a);return c.tags.file=!0,c.value=b,this.files[a]=this.scope.file=c,this.interpret(b)},interpret:function(a){var c=b.parse(a,{attachComment:!0,loc:!0,range:!1});return this.walker.walk(c)},findSymbol:function(a){if(!a)return a;a=a.replace(/#$/g,".prototype").replace(/#/g,".prototype.");var c=b.parse(a,{range:!1});return this.walker.walk(c)},getSymbols:function(){return this.table=new h(this.scope),this.table.symbols}},d(p,{Symbol:f,ObjectType:i,FunctionType:j,ScopeManager:m}),a.Inference=p});